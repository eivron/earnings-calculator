<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Earnings Surprise Calculator</title>
    <link rel="stylesheet" href="static/styles.css">
</head>
<body>
    <h1>Stock Earnings Surprise Calculator</h1>
    <form id="calculatorForm">
        <label for="unit">Revenue in Millions:</label>
        <input type="checkbox" id="unit" name="unit">

        <label for="prev_eps">Previous EPS:</label>
        <input type="number" step="0.01" id="prev_eps" name="prev_eps" required>
        
        <label for="estimated_eps">Estimated EPS:</label>
        <input type="number" step="0.01" id="estimated_eps" name="estimated_eps" required>
        
        <label for="actual_eps">Actual EPS:</label>
        <input type="number" step="0.01" id="actual_eps" name="actual_eps" required>

        <label for="prev_revenue">Previous Revenue:</label>
        <input type="number" step="0.01" id="prev_revenue" name="prev_revenue" required>
        
        <label for="estimated_revenue">Estimated Revenue:</label>
        <input type="number" step="0.01" id="estimated_revenue" name="estimated_revenue" required>
        
        <label for="actual_revenue">Actual Revenue:</label>
        <input type="number" step="0.01" id="actual_revenue" name="actual_revenue" required>
        
        <input type="submit" value="Calculate">
    </form>

    <p id="error" style="color:red; display:none;"></p>

    <h2 id="resultsTitle" style="display:none;">Results</h2>
    <button id="copyButton" style="display:none;">Copy</button>
    <p id="copyMessage" style="display:none; color: green;">Results copied to clipboard</p>
    <div id="results" style="display:none;">
        <p id="resultsContent"></p>
    </div>

    <script>
        function formatNumber(value) {
            // Check if the value is an integer or has decimals
            return Number.isInteger(value) ? value.toString() : value.toFixed(2);
        }

        function formatPercentage(value) {
            // Add + or - sign based on the value
            return (value >= 0 ? "+" : "") + Math.round(value) + "%";
        }

        document.getElementById('calculatorForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent form submission

            // Fetch values from form
            let unit = document.getElementById('unit').checked ? 'M' : 'K';
            let prev_eps = parseFloat(document.getElementById('prev_eps').value);
            let estimated_eps = parseFloat(document.getElementById('estimated_eps').value);
            let actual_eps = parseFloat(document.getElementById('actual_eps').value);
            let prev_revenue = parseFloat(document.getElementById('prev_revenue').value);
            let estimated_revenue = parseFloat(document.getElementById('estimated_revenue').value);
            let actual_revenue = parseFloat(document.getElementById('actual_revenue').value);

            // Error checking
            if (isNaN(prev_eps) || isNaN(estimated_eps) || isNaN(actual_eps) || isNaN(prev_revenue) || isNaN(estimated_revenue) || isNaN(actual_revenue)) {
                document.getElementById('error').innerText = "Please fill out all fields correctly.";
                document.getElementById('error').style.display = 'block';
                return;
            } else {
                document.getElementById('error').style.display = 'none';
            }

            // Perform calculations
            let eps_surprise = ((actual_eps - estimated_eps) / estimated_eps) * 100;
            let eps_yoy = ((actual_eps - prev_eps) / prev_eps) * 100;
            let revenue_surprise = ((actual_revenue - estimated_revenue) / estimated_revenue) * 100;
            let revenue_yoy = ((actual_revenue - prev_revenue) / prev_revenue) * 100;

            // Format results
            let actual_eps_display = `${formatNumber(actual_eps)}c`;
            let estimated_eps_display = `${formatNumber(estimated_eps)}c`;
            let revenue_display = `${formatNumber(actual_revenue)} ${unit}`;
            let estimated_revenue_display = `${formatNumber(estimated_revenue)} ${unit}`;

            // Display results
            document.getElementById('resultsTitle').style.display = 'block';
            document.getElementById('results').style.display = 'block';
            document.getElementById('resultsContent').innerHTML = `
                EPS: ${actual_eps_display}<br>
                Est: ${estimated_eps_display}<br>
                Surp: ${formatPercentage(eps_surprise)}<br>
                YoY: ${formatPercentage(eps_yoy)}<br><br>
                Rev: ${revenue_display}<br>
                Est: ${estimated_revenue_display}<br>
                Surp: ${formatPercentage(revenue_surprise)}<br>
                YoY: ${formatPercentage(revenue_yoy)}
            `;
            document.getElementById('copyButton').style.display = 'block';
        });

        document.getElementById('copyButton').addEventListener('click', function() {
            let results = document.getElementById('resultsContent').innerText;
            let textarea = document.createElement('textarea');
            textarea.value = results;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            var copyMessage = document.getElementById('copyMessage');
            copyMessage.style.display = 'block';
            setTimeout(function() {
                copyMessage.style.display = 'none';
            }, 2000);
        });
    </script>
</body>
</html>
