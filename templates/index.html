<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Earnings Surprise Calculator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <h1>Stock Earnings Surprise Calculator</h1>
    <form method="POST">
        <label for="unit">Revenue in Millions:</label>
        <input type="checkbox" id="unit" name="unit" {% if unit == 'millions' %}checked{% endif %}>

        <label for="prev_eps">Previous EPS:</label>
        <input type="number" step="0.01" id="prev_eps" name="prev_eps" value="{{ prev_eps }}" required>
        
        <label for="estimated_eps">Estimated EPS:</label>
        <input type="number" step="0.01" id="estimated_eps" name="estimated_eps" value="{{ estimated_eps }}" required>
        
        <label for="actual_eps">Actual EPS:</label>
        <input type="number" step="0.01" id="actual_eps" name="actual_eps" value="{{ actual_eps }}" required>

        <label for="prev_revenue">Previous Revenue:</label>
        <input type="number" step="0.01" id="prev_revenue" name="prev_revenue" value="{{ prev_revenue }}" required>
        
        <label for="estimated_revenue">Estimated Revenue:</label>
        <input type="number" step="0.01" id="estimated_revenue" name="estimated_revenue" value="{{ estimated_revenue }}" required>
        
        <label for="actual_revenue">Actual Revenue:</label>
        <input type="number" step="0.01" id="actual_revenue" name="actual_revenue" value="{{ actual_revenue }}" required>
        
        <input type="submit" value="Calculate">
    </form>

    {% if error %}
    <p style="color:red;">{{ error }}</p>
    {% endif %}

    {% if eps_surprise is not none %}
    <h2>Results</h2>
    <button id="copyButton">Copy</button>
    <p id="copyMessage" style="display:none; color: green;">Results copied to clipboard</p>
    <div id="results">
        <p>
            EPS: {{ actual_eps_display }}<br>
            Est: {{ estimated_eps_display }}<br>
            Surp: {{ eps_surprise }}<br>
            YoY: {{ eps_yoy }}<br><br>
            
            Rev: {{ actual_revenue }} {{ unit_display }}<br>
            Est: {{ estimated_revenue }} {{ unit_display }}<br>
            Surp: {{ revenue_surprise }}<br>
            YoY: {{ revenue_yoy }}<br>
        </p>
    </div>
    {% endif %}

    <script>
        document.getElementById('copyButton').addEventListener('click', function() {
            var results = document.getElementById('results').innerText;
            var textarea = document.createElement('textarea');
            textarea.value = results;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            var copyMessage = document.getElementById('copyMessage');
            copyMessage.style.display = 'block';
            setTimeout(function() {
                copyMessage.style.display = 'none';
            }, 2000);
        });
    </script>
</body>
</html>
